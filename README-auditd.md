# lugdd_auditd

```bash
ps aux | grep -i auditd

```


## key compontents

- auditd — main daemon writing logs
- auditctl — command to manage audit rules dynamically
- augenrules — tool to manage rule files persistently
- ausearch / aureport — tools for searching & reporting audit logs

```bash
[root@ip-172-31-22-146 ec2-user]# ls -l /etc/audit
total 12
-rw-r----- 1 root root 805 Aug 17  2018 auditd.conf
-rw-r----- 1 root root  81 Dec  9 09:15 audit.rules
-rw-r----- 1 root root 127 Aug 17  2018 audit-stop.rules
drwxr-x--- 2 root root  25 Mar  4  2021 rules.d
```

##

These are always enabled, even with zero rules:

- USER_START / USER_END
- CRED_ACQUIRE / CRED_DISP / CRED_REFR
- LOGIN / CONFIG / ANOM_events
- DAEMON events

These come from:

- The Linux kernel audit subsystem
- PAM modules (pam_loginuid, pam_unix, pam_systemd)
- systemd session handling

These events cannot be disabled with audit rules, because they provide essential accountability.


```bash
cat /etc/audit/audit.rules

## This file is automatically generated from /etc/audit/rules.d
-D
-b 8192
-f 1
```

`-f 1` - failure mode

Determines system behavior if audit messages cannot be delivered

1 = log and continue

0 = silent ignore

2 = panic — system becomes unusable to protect integrity)

- Add rule files under /etc/audit/rules.d/ such as:

```bash
cat /usr/lib/systemd/system/auditd.service

[Unit]
RefuseManualStop=yes
```


## User, group, password databases
-w /etc/group -p wa -k etcgroup
-w /etc/passwd -p wa -k etcpasswd
-w /etc/gshadow -k etcgroup
-w /etc/shadow -k etcpasswd
-w /etc/security/opasswd -k opasswd

auditctl -w /tmp/testfile -p w -k testfile_write
auditctl -w /tmp/testfile -p r -k testfile_read


echo "hello_world" > /tmp/testfile


```bash
type=SYSCALL msg=audit(1765282312.834:533): arch=c000003e syscall=257 success=yes exit=3 a0=ffffffffffffff9c a1=184eeb0 a2=241 a3=1b6 items=2 ppid=32744 pid=32746 auid=1001 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts2 ses=25 comm="bash" exe="/usr/bin/bash" key="testfile_write"
type=CWD msg=audit(1765282312.834:533): cwd="/home/ec2-user"
type=PATH msg=audit(1765282312.834:533): item=0 name="/tmp/" inode=101 dev=103:01 mode=041777 ouid=0 ogid=0 rdev=00:00 nametype=PARENT cap_fp=0000000000000000 cap_fi=0000000000000000 cap_fe=0 cap_fver=0
type=PATH msg=audit(1765282312.834:533): item=1 name="/tmp/testfile" inode=125034 dev=103:01 mode=0100644 ouid=0 ogid=0 rdev=00:00 nametype=NORMAL cap_fp=0000000000000000 cap_fi=0000000000000000 cap_fe=0 cap_fver=0
type=PROCTITLE msg=audit(1765282312.834:533): proctitle="/bin/bash"
```

| Field             | Value              | Description                           |
| ----------------- | ------------------ | ------------------------------------- |
| type              | SYSCALL            | System call event                     |
| timestamp         | 1765282312.834:533 | Event time + event ID                 |
| arch              | c000003e           | x86_64 syscall ABI                    |
| syscall           | 257                | `openat()` system call                |
| success           | yes                | Call succeeded                        |
| exit              | 3                  | File descriptor returned              |
| a0 / a1 / a2 / a3 | Various            | System call arguments                 |
| items             | 2                  | Number of file objects involved       |
| ppid              | 32744              | Parent process ID                     |
| pid               | 32746              | Process ID                            |
| auid              | 1001               | Audit user ID (original login user)   |
| uid               | 0                  | Real UID (root)                       |
| gid               | 0                  | Real GID                              |
| euid              | 0                  | Effective UID (root)                  |
| suid              | 0                  | Saved UID                             |
| fsuid             | 0                  | File system UID                       |
| fsgid             | 0                  | File system GID                       |
| tty               | pts2               | Terminal used                         |
| ses               | 25                 | Login session ID                      |
| comm              | bash               | Command name                          |
| exe               | /usr/bin/bash      | Executable path                       |
| key               | testfile_write     | Audit rule key that triggered logging |

```
ausearch --interpret -k testfile_write

```


### configurations

- Best Practice Auditd Configuration

https://github.com/Neo23x0/auditd/blob/master/audit.rules

https://github.com/linux-audit/audit-userspace/tree/master

- PCIDSS 3.1 rules proposal
https://github.com/linux-audit/audit-userspace/blob/master/rules/30-pci-dss-v31.rules


### plugins

- laurel - Transform Linux Audit logs for SIEM usage